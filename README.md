# Paket Guide for F# Scripts

Paket is a dependency management tool for F#.
With Paket, one can manage references to NuGet packages, files on GitHub, or files from any HTTP resource.

## Initializing a Paket Project

Paket is installed as a project-specific tool using the `dotnet` cli.

1. Create a new directory and initialize a solution.

   ```shell
   mkdir PaketGuide
   cd PaketGuide
   dotnet new sln
   ```

2. Invoke the following to install Paket as a local tool.

   ```shell
   dotnet new tool-manifest
   dotnet tool install paket
   dotnet tool restore
   ```

3. Initialize a Paket dependencies file. This file will contain references to dependencies.

   ```shell
   dotnet paket init
   ```

4. Add the following to `.gitignore`.
   ```shell
   # Paket
   .paket/
   paket-files/
   ```

## Core Concepts

There are three files which are used by Paket to manage dependencies.

- `paket.dependencies` - Specifies dependencies and versions for entire codebase. Resides in _solution root_ (same level as `.sln` file).
- `paket.references` - Specifies a subset of dependencies for every project in a solution. Resides in _project root_ (same level as `.fsproj` file).
- `paket.lock` - A lock file generated by Paket. This is used to get reproducible builds when checked into source control.

The `paket.dependencies` and `paket.references` files can be manually edited.
The `paket.lock` file should not be edited by the user.

All three files should be committed into source control.

## Basic Command Cheat Sheet

| Command                                                 | Description                                                                                                                                                                   |
| ------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `dotnet paket install`                                  | Run after updating `paket.dependencies` file with new package references. Updates lock file, and refreshes all projects that specify paket dependencies to import references. |
| `dotnet paket update`                                   | Updates references to latest versions of all dependent packages.                                                                                                              |
| `dotnet paket restore`                                  | Takes current `paket.lock` file and updates all projects to reference correction versions of NuGet packages. Should be called by your build script.                           |
| `dotnet paket outdated`                                 | List dependencies that have updates.                                                                                                                                          |
| `dotnet paket generate-load-scripts --framework net6.0` | This command is used to generate _include scripts_ which can be used in `.fsx` files or F# interactive.                                                                       |

## Loading Dependencies with F# Scripts

Managing dependencies for F# and C# projects is straightforward using the above commands.
But what if you write some F# scripts (`.fsx` files) which need to use external packages?
Those can be directly invoked using `dotnet fsi myscript.fsx` and are often sufficient
for simple tasks that don't need the full project structure.

Paket offers a command to generate F# and C# _include scripts_ that
reference installed packages. These _include scripts_ can be used in
F# Interactive (FSI) or `.fsx` files to load packages.

These are created under `.paket/load/`.

The generated load scripts reference DLLs from installed packages using `#r`
preprocessing directives.
Additionally, all scripts in a `loadscripts` directory in the package will be
referenced by `#load`, as will any script `PackageName.fsx` in the root of the package.

The `dotnet paket generate-load-scripts` command only works after packages have been restored.
To generate load scripts when installing packages, place `generate_load_scripts: true` at
the top of the `paket.dependencies` file.

```
generate_load_scripts: true
source https://api.nuget.org/v3/index.json

storage: none
framework: net6.0
nuget BlackFox.ColoredPrintf 1.0.5
nuget FSharp.Core 6.0.1
```

In a `.fsx` file you can then reference the external package.

```f#
#load @".paket/load/BlackFox.ColoredPrintf.fsx"

open BlackFox.ColoredPrintf
```
